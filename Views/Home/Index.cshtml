@model StARKS.Models.MainTableViewModel

@{
    ViewData["Title"] = "Home Page";
}

<label>
    <select class="container-md" id="filterStudents">Filter students...</select>
    <select id="filterCourses">Filter courses...</select>
</label>
<lasbel class="float-right">
    <b/>
    <a asp-controller="Courses" asp-action="Create"> Add Course </a> |
    <a asp-controller="Students" asp-action="Create"> Add Student </a>
</lasbel>
<table id="mainTable" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
    <thead>
        <tr>
            <th>
            </th>
            @foreach (var course in Model.Courses)
            {
                <th>
                    <a class="align-middle" asp-controller="Courses" asp-action="Details" asp-route-id="@course.Code">
                        <b>@course.Name</b>
                    </a>
                </th>
            }

        </tr>
    </thead>
    <tbody>
        @foreach (var student in Model.Students)
        {
            <tr>
                <td>
                    <a asp-controller="Students" asp-action="Details" asp-route-id="@student.StudentId">
                        @student.StudentFullName
                    </a>
                </td>

                @foreach (var mark in student.Marks)
                {
                    <td>
                        <div id="student" hidden value="@mark.StudentId"></div>
                        <div id="course" hidden value="@mark.CourseCode"></div>
                        <input id="mark" type="number"  value="@mark.MarkValue" min="6" max="10">
                    </td>
                }
            </tr>
        }
    </tbody>
</table>

@section scripts {



    <script type="text/javascript">

        $(document).ready(function () {

            $("input#mark").focusout(function () {

                var studentId = $(this).siblings('#student').attr("value");
                var courseId = $(this).siblings('#course').attr("value");
                var mark = $(this).val();

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("MarkProcessing", "Home")',
                    data: {
                        "Id":0,
                        "courseCode": courseId,
                        "studentId": studentId,
                        "markValue": mark
                    },
                    success: function(recData) { alert('Success'); },
                    error: function() { alert('A error'); }
                });

             });


            $('#filterStudents').select2({
                    ajax: {
                        url: '@Url.Action("ShipToAutoComplete")',
                        dataType: 'json'
                    },
                    placeholder: "Filter students...",
                    allowClear: true,
                    minimumInputLength: 3
            });
        });
    </script>
}